<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Sistema de Chamados — Usuário</title>
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="style_usuario.css">
  </head>
  <body>
    <header>
      <div class="brand">
        <div class="logo">SI</div>
        <div>
          <div style="font-weight: 700">Sistema Inteligente de Chamados</div>
          <div style="font-size: 13px; color: #c7d2fe">Visão do Usuário</div>
        </div>
      </div>
      <div class="actions">
        <a class="ghost" href="../index.html" onclick="localStorage.removeItem('currentUser')">Início</a>
        <div id="userBadge" style="display:flex; align-items:center; gap:8px"></div>
        <div class="search">
          <input
            id="searchInput" 
            placeholder="Buscar chamados (título, categoria)"
          />
          <button class="ghost-user" onclick="filterTickets()">Buscar</button>
        </div>
        <button class="btn" id="btnOpenModal">+ Novo Chamado</button>
      </div>
    </header>

    <main class="container">
      <div class="top-row">
        <div class="cards">
          <div class="card">
            <h3>Chamados Abertos</h3>
            <p id="openCount">0</p>
          </div>
          <div class="card">
            <h3>Chamados Em Andamento</h3>
            <p id="inProgressCount">0</p>
          </div>
          <div class="card">
            <h3>Chamados Resolvidos</h3>
            <p id="resolvedCount">0</p>
          </div>
        </div>
        <div style="min-width: 250px">
          <div class="card card-small">
            <div style="display: flex; align-items: center; gap: 10px">
              <div style="flex: 1">
                <div style="font-weight: 700">Olá, Usuário</div>
                <div class="muted">Acompanhe seus chamados</div>
              </div>
              <div
                style="
                  width: 54px;
                  height: 54px;
                  border-radius: 10px;
                  background: #eef2ff;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-weight: 700;
                  color: #2563eb;
                "
              >
                U
              </div>
            </div>
          </div>
        </div>
      </div>

      <div>
        <div class="tabs">
          <button
            class="tab active"
            data-view="minha-lista"
            onclick="switchTab(event)"
          >
            Meus Chamados
          </button>
          <button class="tab" data-view="abertos" onclick="switchTab(event)">
            Todos
          </button>
          <button class="tab" data-view="resolvidos" onclick="switchTab(event)">
            Resolvidos
          </button>
        </div>

        <section id="view-minha-lista">
          <table id="ticketsTable">
            <thead>
              <tr>
                <th>#</th>
                <th>Título</th>
                <th>Categoria</th>
                <th>Urgência (IA)</th>
                <th>Status</th>
                <th>Última Atualização</th>
              </tr>
            </thead>
            <tbody id="ticketsBody"></tbody>
          </table>
        </section>

        <section id="view-abertos" style="display: none">
          <div class="note">
            Lista com todos os chamados do usuário (incluindo histórico).
          </div>
          <table id="ticketsTableAll" style="margin-top: 8px">
            <thead>
              <tr>
                <th>#</th>
                <th>Título</th>
                <th>Categoria</th>
                <th>Urgência</th>
                <th>Status</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody id="ticketsBodyAll"></tbody>
          </table>
        </section>

        <section id="view-resolvidos" style="display: none">
          <div class="note">Chamados concluídos e feedbacks.</div>
          <table style="margin-top: 8px">
            <thead>
              <tr>
                <th>#</th>
                <th>Título</th>
                <th>Satisfação</th>
                <th>Data de Fechamento</th>
              </tr>
            </thead>
            <tbody id="ticketsBodyClosed"></tbody>
          </table>
        </section>
      </div>
    </main>

    <div class="modal" id="modalNew">
      <div class="panel">
        <h3>Novo Chamado</h3>
        <div class="ia-box" style="margin-top: 10px">
          <div style="font-size: 13px">
            Dica: descreva o problema com o máximo de detalhes. A IA irá sugerir
            categoria e urgência automaticamente.
          </div>
        </div>
        <form
          id="frmNew"
          style="margin-top: 12px"
          onsubmit="return submitTicket(event)"
        >
          <label for="titulo">Título *</label>
          <input
            id="titulo"
            required
            type="text"
            placeholder="Ex: Não recebo e-mails"
          />
          <label for="descricao">Descrição *</label>
          <textarea
            id="descricao"
            required
            placeholder="Descreva o problema com passos, erros e quando começou..."
          ></textarea>
          <div class="flex" style="margin-top: 8px">
            <div style="flex: 1">
              <label for="categoria">Categoria</label>
              <select id="categoria">
                <option>Software</option>
                <option>Hardware</option>
                <option>Rede</option>
                <option>Outros</option>
              </select>
            </div>
            <div style="width: 160px">
              <label for="canal">Canal</label>
              <select id="canal">
                <option>Portal</option>
                <option>E-mail</option>
                <option>Telefone</option>
              </select>
            </div>
          </div>

          <div
            style="
              display: flex;
              gap: 8px;
              margin-top: 12px;
              align-items: center;
            "
          >
            <input type="file" id="anexo" />
            <div class="right">
              <button type="button" class="ghost" onclick="closeModal()">
                Cancelar
              </button>
              <button class="btn" type="submit">Enviar</button>
            </div>
          </div>

          <div
            id="iaSuggestion"
            style="margin-top: 12px; display: none"
            class="ia-box"
          ></div>
        </form>
      </div>
    </div>

    <div class="modal" id="modalView">
      <div class="panel">
        <h3 id="viewTitle"># Chamado</h3>
        <p class="muted" id="viewMeta">Status: Aberto • Categoria: Software</p>
        
        <hr style="border: 0; border-top: 1px solid #eef2f7; margin: 12px 0;">

        <div class="conversa-historico" id="viewHistory">
          <div class="history-item">Carregando histórico...</div>
        </div>

        <hr style="border: 0; border-top: 1px solid #eef2f7; margin: 12px 0;">

        <div class="responder-area">
          <label for="viewReplyText">Adicionar uma resposta:</label>
          <textarea id="viewReplyText" placeholder="Digite sua resposta ou mais detalhes aqui..."></textarea>
          <div style="display: flex; justify-content: flex-end; gap: 8px; margin-top: 8px;">
            <button type="button" class="ghost" onclick="closeViewModal()">
              Fechar
            </button>
            <button class="btn" type="button" onclick="sendUserReply()">Enviar Resposta</button>
          </div>
        </div>
      </div>
    </div>

    <footer>
      Projeto de Protótipo • Sistema Inteligente de Chamados — Visão do Usuário
    </footer>

    <script src="script_usuario.js"></script>
  </body>
</html>